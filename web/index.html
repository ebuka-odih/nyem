<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Nyem - Your Local Marketplace</title>

  <!-- PWA Meta Tags -->
  <meta name="description"
    content="Connect with your community to buy, sell, trade items, and find trusted artisans. Swipe through local listings and discover great deals, services, and swap opportunities in your city." />
  <meta name="theme-color" content="#880e4f" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Nyem" />

  <!-- iOS Safari PWA Support -->
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
  <link rel="apple-touch-icon" sizes="72x72" href="/icon-72x72.png" />
  <link rel="apple-touch-icon" sizes="96x96" href="/icon-96x96.png" />
  <link rel="apple-touch-icon" sizes="128x128" href="/icon-128x128.png" />
  <link rel="apple-touch-icon" sizes="144x144" href="/icon-144x144.png" />
  <link rel="apple-touch-icon" sizes="152x152" href="/icon-152x152.png" />
  <link rel="apple-touch-icon" sizes="192x192" href="/icon-192x192.png" />
  <link rel="apple-touch-icon" sizes="384x384" href="/icon-384x384.png" />
  <link rel="apple-touch-icon" sizes="512x512" href="/icon-512x512.png" />

  <!-- Android Chrome PWA Support -->
  <link rel="manifest" href="/manifest.json" />
  <link rel="icon" type="image/png" sizes="192x192" href="/icon-192x192.png" />
  <link rel="icon" type="image/png" sizes="512x512" href="/icon-512x512.png" />

  <!-- Favicon -->
  <link rel="shortcut icon" href="/favicon.ico" />

  <!-- Register Service Worker for Early Boot -->
  <script>
    if ('serviceWorker' in navigator) {
      window.serviceWorkerRegistrationPromise = navigator.serviceWorker
        .register(new URL('/sw.js', window.location.origin).href, {
          updateViaCache: 'none',
          scope: '/'
        })
        .then(function (registration) {
          console.log('Service Worker registered:', registration.scope);
          window.serviceWorkerRegistration = registration;
          return registration;
        })
        .catch(function (error) {
          console.warn('Service Worker registration failed:', error);
          return null;
        });
    }
  </script>

  <!-- OneSignal Web Push Notifications -->
  <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
  <script>
    window.OneSignalDeferred = window.OneSignalDeferred || [];
    window.OneSignalReady = new Promise((resolve) => {
      OneSignalDeferred.push(async function (OneSignal) {
        try {
          await OneSignal.init({
            appId: "401c6128-33c4-47ba-af30-337413de42bb",
            serviceWorkerPath: 'sw.js',
            serviceWorkerParam: { scope: '/' },
          });
          // Store OneSignal instance globally
          window.OneSignal = OneSignal;
          console.log('OneSignal initialized successfully');
          resolve(OneSignal);
        } catch (error) {
          console.error('OneSignal initialization failed:', error);
          resolve(null);
        }
      });
    });
  </script>

  <!-- PushAlert Unified Code - COMMENTED OUT FOR TESTING ONESIGNAL -->
  <!-- Load PushAlert after service worker is ready -->
  <!--
  <script type="text/javascript">
    (function() {
      var loadPushAlert = function() {
        var g = document.createElement("script");
        var s = document.getElementsByTagName("script")[0];
        g.src = "https://cdn.pushalert.co/unified_64c21421543ea0b4bdf6d1cadfae7894.js";
        g.async = true;
        s.parentNode.insertBefore(g, s);
      };
      
      // Wait for service worker to be ready before loading PushAlert
      if ('serviceWorker' in navigator) {
        // Wait for service worker registration promise
        if (window.serviceWorkerRegistrationPromise) {
          window.serviceWorkerRegistrationPromise.then(function(registration) {
            if (registration) {
              // Wait for service worker to be ready (active state)
              return navigator.serviceWorker.ready.then(function(reg) {
                console.log('Service Worker ready for PushAlert:', reg.scope);
                // Additional delay to ensure service worker is fully initialized
                setTimeout(loadPushAlert, 500);
                return reg;
              });
            } else {
              // Registration failed, still try to load PushAlert
              setTimeout(loadPushAlert, 1000);
            }
          }).catch(function(error) {
            console.warn('Service Worker registration error:', error);
            // If promise fails, still try to load PushAlert after delay
            setTimeout(loadPushAlert, 1000);
          });
        } else {
          // No promise yet, wait a bit and try to get registration
          setTimeout(function() {
            navigator.serviceWorker.getRegistration().then(function(registration) {
              if (registration) {
                window.serviceWorkerRegistration = registration;
                setTimeout(loadPushAlert, 500);
              } else {
                // No registration found, load PushAlert anyway
                setTimeout(loadPushAlert, 1000);
              }
            }).catch(function() {
              setTimeout(loadPushAlert, 1000);
            });
          }, 1000);
        }
      } else {
        // No service worker support, load PushAlert anyway
        setTimeout(loadPushAlert, 500);
      }
    })();
  </script>
  -->
  <!-- End PushAlert Unified Code -->

  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');

    :root {
      /* Safe area insets for iOS devices with notch */
      --safe-area-inset-top: env(safe-area-inset-top, 0px);
      --safe-area-inset-right: env(safe-area-inset-right, 0px);
      --safe-area-inset-bottom: env(safe-area-inset-bottom, 0px);
      --safe-area-inset-left: env(safe-area-inset-left, 0px);
    }

    body {
      font-family: 'Inter', sans-serif;
      overscroll-behavior-y: none;
    }

    /* Hide scrollbar for Chrome, Safari and Opera */
    .no-scrollbar::-webkit-scrollbar {
      display: none;
    }

    /* Hide scrollbar for IE, Edge and Firefox */
    .no-scrollbar {
      -ms-overflow-style: none;
      /* IE and Edge */
      scrollbar-width: none;
      /* Firefox */
    }
  </style>
</head>

<body class="bg-slate-50 m-0 p-0 overflow-hidden" style="position: fixed; width: 100%; height: 100vh; height: 100dvh;">
  <div id="root" style="width: 100%; height: 100%; overflow: hidden;"></div>
  <div class='onesignal-customlink-container'></div>
  <script type="module" src="index.tsx"></script>
</body>

</html>